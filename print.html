<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Operations UX</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="workflow_scenario.html"><strong aria-hidden="true">2.</strong> Workflow Scenario</a></li><li class="chapter-item expanded "><a href="dimensions.html"><strong aria-hidden="true">3.</strong> Dimensions</a></li><li class="chapter-item expanded "><a href="path_handling.html"><strong aria-hidden="true">4.</strong> Path Handling</a></li><li class="chapter-item expanded "><a href="state_visibility.html"><strong aria-hidden="true">5.</strong> State Visibility</a></li><li class="chapter-item expanded "><a href="understandability.html"><strong aria-hidden="true">6.</strong> Understandability</a></li><li class="chapter-item expanded "><a href="recoverability_repeatability.html"><strong aria-hidden="true">7.</strong> Recoverability / Repeatability</a></li><li class="chapter-item expanded "><a href="performance_efficiency.html"><strong aria-hidden="true">8.</strong> Performance / Efficiency</a></li><li class="chapter-item expanded "><a href="psychology.html"><strong aria-hidden="true">9.</strong> Psychology</a></li><li class="chapter-item expanded "><a href="future.html"><strong aria-hidden="true">10.</strong> Future</a></li><li class="chapter-item expanded "><a href="qfc.html"><strong aria-hidden="true">11.</strong> QFC</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="links.html">Links</a></li><li class="chapter-item expanded affix "><a href="common_issues.html">Common Issues</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Operations UX</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div style="font-size: 15em;">üöÇüí®</div>
<p>User friendly automation is hard to write, and is hard to get right.</p>
<blockquote>
<p>Minimum viable product (MVP) is not user friendly.</p>
</blockquote>
<p>This book describes different dimensions that influence the user friendliness of software, and introduces a new library ‚Äì <a href="https://github.com/azriel91/choochoo"><code>choochoo</code></a> ‚Äì that tries to support writing software that is more user friendly.</p>
<h1 id="workflow-scenario"><a class="header" href="#workflow-scenario">Workflow Scenario</a></h1>
<p>Consider the deployment steps for a standalone web application backed by a database.</p>
<p>The following steps represents this workflow:</p>
<p><img src="workflow_scenario_takeaway_sequential_process_0.generated.svg" alt="" title="Takeaway Sequential Process" /></p>
<h1 id="dimensions"><a class="header" href="#dimensions">Dimensions</a></h1>
<p>In this book, a dimension is defined as a particular nature of something. Dimensions may be independent, and may be measurable. Some dimensions may be derived from and may be influenced by others.</p>
<p>For example, an object's dimensions are:</p>
<ul>
<li>Size</li>
<li>Mass</li>
<li>Temperature</li>
<li>Colour</li>
</ul>
<h2 id="software-dimensions"><a class="header" href="#software-dimensions">Software Dimensions</a></h2>
<p>We will look at the following software dimensions, and show how <a href="https://github.com/azriel91/choochoo"><code>choochoo</code></a> supports building software with higher maturity levels of user friendliness.</p>
<ol>
<li><strong>Path Handling:</strong> How exhaustive code path coverage is, and how each path is handled.</li>
<li><strong>State Visibility:</strong> What state is it in now, progress tracking.</li>
<li><strong>Understandability:</strong> Presentation / verbosity.</li>
<li><strong>Recoverability / Repeatability:</strong> Can execution resume from halfway.</li>
<li><strong>Performance / Efficiency:</strong> How well is execution scheduled, time spent, and resources used.</li>
<li><strong>Psychology:</strong> Did the user request what they intended?</li>
</ol>
<h1 id="path-handling"><a class="header" href="#path-handling">Path Handling</a></h1>
<blockquote>
<p>How exhaustive code path coverage is, and how each path is handled.</p>
</blockquote>
<p><img src="path_handling_workflow_with_errors_0.generated.svg" alt="" title="Workflow With Errors" /></p>
<h2 id="maturity-levels"><a class="header" href="#maturity-levels">Maturity Levels</a></h2>
<p><img src="path_handling_download_app_1.generated.svg" alt="" title="Download App" /></p>
<details>
<summary><b>Happy Path only</b></summary>
<div style="margin-left: 18px;">
<p><img src="path_handling_download_app_happy_path_only_2.generated.svg" alt="" title="Download app happy path only" /></p>
<ol>
<li>If it works, it works.</li>
<li>If it fails, it might crash, it might carry on with a bad value.</li>
</ol>
<details>
<summary>code snippets</summary>
<div style="margin-left: 18px;">
<p>Bash:</p>
<pre><code class="language-bash">#! /bin/bash
curl http://somewhere.com/app.zip -o app.zip

# Much better with:
# set -euo pipefail
</code></pre>
<p>C#:</p>
<pre><code class="language-c#">void AppDownload()
{
    var webClient = new WebClient();
    webClient.DownloadFile(&quot;https://somewhere.com/app.zip&quot;, &quot;app.zip&quot;);
}
</code></pre>
<p>In Rust:</p>
<pre><code class="language-rust ignore">fn app_download() {
    let bytes = reqwest::blocking::get(&quot;https://somewhere.com/app.zip&quot;)
        .unwrap()
        .bytes()
        .unwrap();

    let mut file = File::create(&quot;app.zip&quot;).unwrap();
    file.write_all(bytes).unwrap();
}
</code></pre>
</div>
</details>
<h3 id="model-attributes"><a class="header" href="#model-attributes">Model Attributes</a></h3>
<ul>
<li>Fast to implement / test how things should work.</li>
<li>Maintenance cost scales quickly with usage.</li>
<li>Difficult (costly) to diagnose failure (no logic to reply with failure information).</li>
</ul>
</div>
</details>
<details>
<summary><b>It worked vs it didn't</b></summary>
<div style="margin-left: 18px;">
<p>Similar to &quot;happy path only&quot;, but treat all errors the same.</p>
<p>To the user, this is similar to happy path only, but in code, there is effort to capture whether something worked vs it did not work.</p>
<p><img src="path_handling_download_app_success_vs_error_3.generated.svg" alt="" title="Download app success vs error" /></p>
<details>
<summary>code snippets</summary>
<div style="margin-left: 18px;">
<p>C#:</p>
<pre><code class="language-c#">void AppDownload()
{
    var webClient = new WebClient();

    try { webClient.DownloadFile(&quot;https://somewhere.com/app.zip&quot;, &quot;app.zip&quot;); }
    catch (Exception e)
    {
        throw new System.InvalidOperationException(&quot;Failed to download app.zip&quot;, e);
    }
}
</code></pre>
<p>Rust:</p>
<pre><code class="language-rust ignore">fn app_download() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let bytes = reqwest::blocking::get(&quot;https://somewhere.com/app.zip&quot;)?.bytes()?;

    let mut file = File::create(&quot;app.zip&quot;)?;
    file.write_all(bytes)?;
}
</code></pre>
</div>
</details>
<h3 id="model-attributes-1"><a class="header" href="#model-attributes-1">Model Attributes</a></h3>
<ul>
<li>Medium effort to implement / test how things should work.</li>
<li>Maintenance cost still scales quickly with usage.</li>
<li>May be difficul to diagnose failure (failure information is not suitable to pass across systems ‚Äì not strongly typed).</li>
</ul>
</div>
</details>
<details>
<summary><b>99% complete<sup>1</sup> handling</b></summary>
<div style="margin-left: 18px;">
<p>Every code path is handled; same treatment of two code paths is intentional.</p>
<p><img src="path_handling_download_app_separate_code_path_handling_4.generated.svg" alt="" title="Download app separate code path handling" /></p>
<p>Every error has its own type, so at compile time you know exactly what case you are handling.</p>
<p>Rust supports you by having <strong>sum types</strong> and <strong>exhaustive pattern matching</strong>.</p>
<details>
<summary>code snippets</summary>
<div style="margin-left: 18px;">
<p>C#:</p>
<pre><code class="language-c#">void AppDownload()
{
    var webClient = new WebClient();
    var download_failed = new System.InvalidOperationException(&quot;Failed to download app.zip&quot;, e);

    // https://docs.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadfile?view=net-5.0
    try { webClient.DownloadFile(&quot;https://somewhere.com/app.zip&quot;, &quot;app.zip&quot;); }
    catch (ArgumentNullException e) { throw download_failed; }
    catch (WebException e)          { throw download_failed; }
    catch (NotSupportedException e) { throw download_failed; }
}
</code></pre>
<p>Rust:</p>
<pre><code class="language-rust ignore">enum Error {
    Connect(reqwest::Error),
    Download(reqwest::Error),
    AppCreateFile(std::io::Error),
    AppWriteToDisk(std::io::Error),
}

fn app_download() -&gt; Result&lt;(), Error&gt; {
    let bytes = reqwest::blocking::get(&quot;https://somewhere.com/app.zip&quot;)
        .map_err(Error::Connect)?
        .bytes()
        .map_err(Error::Download)?;

    let mut file = File::create(&quot;app.zip&quot;).map_err(Error::AppCreateFile)?;
    file.write_all(bytes).map_err(Error::AppWriteToDisk)?;
}
</code></pre>
</div>
</details>
<h3 id="model-attributes-2"><a class="header" href="#model-attributes-2">Model Attributes</a></h3>
<ul>
<li>Highest effort to implement.</li>
<li>Maintenance cost scales slowly with usage.</li>
<li>Easier to diagnose failure as the error should indicate the exact point in the sequence of events where the failure occurs.</li>
</ul>
<p><sup>1</sup> <sub>99% because we aren't handling running out of memory, or the power went out</sub></p>
</div>
</details>
<h2 id="api-implications"><a class="header" href="#api-implications">API Implications</a></h2>
<ul>
<li>Any possible failing functions must return <code>Result</code>.</li>
<li>So, the return type of consumer-implemented functions must be type parameterized.</li>
<li>Handle interrupts and stop gracefully.</li>
</ul>
<p><code>choochoo</code> constrains users to provide <a href="https://github.com/azriel91/srcerr"><code>srcerr:SourceError&lt;E&gt;</code></a>, which requires users to implement:</p>
<ul>
<li>Strongly typed error codes.</li>
<li>Provide the error information that <a href="https://github.com/brendanzab/codespan"><code>codespan-reporting</code></a> can consume.</li>
</ul>
<h2 id="importance"><a class="header" href="#importance">Importance</a></h2>
<p>Arguably the most important dimension for robustness ‚Äì ensuring that a system is not left in an unknown / unrecoverable state.</p>
<h2 id="live-demo"><a class="header" href="#live-demo">Live Demo</a></h2>
<ul>
<li>
<p>Artifact server:</p>
<pre><code class="language-bash">mkdir /tmp/server &amp;&amp; cd /tmp/server
</code></pre>
<pre><code class="language-bash">simple-http-server --nocache -u --ip 127.0.0.1 --port 8000 -l 100000000
</code></pre>
</li>
<li>
<p>Build agent:</p>
<pre><code class="language-bash">mkdir -p /tmp/choochoo/demo/station_a/ &amp;&amp; cd /tmp/choochoo/demo/station_a/
</code></pre>
<pre><code class="language-bash">for i in {1..200000}; do printf &quot;application contents $i&quot;; done | gzip -f &gt; app.zip
</code></pre>
<pre><code class="language-bash">rm -rf /tmp/choochoo/demo/station_{b,c,d,e,f,g,h} /tmp/server/app.zip
</code></pre>
</li>
<li>
<p><code>choochoo</code>:</p>
<pre><code class="language-bash">time ./target/release/examples/demo
</code></pre>
</li>
</ul>
<p>Scenarios:</p>
<ul>
<li>Happy Path.</li>
<li>Cannot connect to artifact server.</li>
<li>Stop server before downloading.</li>
</ul>
<h1 id="state-visibility"><a class="header" href="#state-visibility">State Visibility</a></h1>
<blockquote>
<p>What state is it in now, progress tracking.</p>
</blockquote>
<p>Is enough information captured and presented.</p>
<h2 id="maturity-levels-1"><a class="header" href="#maturity-levels-1">Maturity Levels</a></h2>
<details>
<summary><b>Zero Visibility:</b> It's running vs it's not.</summary>
<div style="margin-left: 18px;">
<p><img src="state_visibility_progress_tracking_0.generated.svg" alt="" title="Progress Tracking" /></p>
</div>
</details>
<details>
<summary><b>Imperative:</b> You can see the completed steps, but not necessarily remaining steps.</summary>
<div style="margin-left: 18px;">
<p><img src="state_visibility_progress_tracking_1.generated.svg" alt="" title="Progress Tracking" /></p>
<details>
<summary>If it fails, you will be able to see how far it got.</summary>
<div style="margin-left: 18px;">
<p><img src="state_visibility_naive_workflow_failure_2.generated.svg" alt="" title="Naive Workflow Failure" /></p>
</div>
</details>
<br/>
</div>
</details>
<details>
<summary><b>Planner:</b> The steps to completion are known, and progress is shown.</summary>
<div style="margin-left: 18px;">
<p><img src="state_visibility_progress_tracking_3.generated.svg" alt="" title="Progress Tracking" /></p>
</div>
</details>
<h2 id="api-implications-1"><a class="header" href="#api-implications-1">API Implications</a></h2>
<ul>
<li>Need overall execution plan steps.</li>
<li>Additional steps discovered at runtime are &quot;sub-steps&quot;.</li>
<li>Elapsed duration is essential.</li>
<li>Accurate estimated duration remaining is nice, but can be difficult to provide.</li>
</ul>
<h2 id="live-demo-1"><a class="header" href="#live-demo-1">Live Demo</a></h2>
<ul>
<li>All tasks are listed.</li>
<li>Each task has progress limit.</li>
<li>Colours for failure / success / in progress.</li>
</ul>
<h1 id="understandability"><a class="header" href="#understandability">Understandability</a></h1>
<blockquote>
<p>Presentation / verbosity.</p>
</blockquote>
<p>Show information when it's relevant, hide information when it's not.</p>
<h2 id="maturity-levels-2"><a class="header" href="#maturity-levels-2">Maturity Levels</a></h2>
<details>
<summary><b>üìÉ Text, text everywhere..</b></summary>
<div style="margin-left: 18px;">
<p>Show the user 200 MB of uncoloured logs per minute.</p>
<pre><code class="language-text">2021-02-21T15:13:01.123 | Debug | my::krate::module | Starting application.
2021-02-21T15:13:01.325 | Info | another::krate::module | Connecting to server.
2021-02-21T15:13:01.500 | Debug | third::krate::module | Resolving DNS for `some.domain.com`.
2021-02-21T15:13:01.531 | Debug | someones::krate::module | Looking up name server for `some.domain.com`
2021-02-21T15:13:01.570 | Debug | third::krate::module | DNS Resolved to 1.2.3.4
..
</code></pre>
</div>
</details>
<details>
<summary><b>üé® Beautiful</b></summary>
<div style="margin-left: 18px;">
<p><em>&quot;The ultimate complexity is simplicity.&quot;</em></p>
<ul>
<li>Show useful information.</li>
<li>Hide unnecessary information.</li>
<li><em>Could:</em> Show progress detail for current step, hide detail when it's done.</li>
<li>Highlight important information, dim contextual information.</li>
</ul>
<p>Example progress:</p>
<div style="background-color: #111111; color: #ffffff; padding: 0px 5px 2px 5px; border-radius: 4px; width: 900px;">
<pre class="terminal">
<span class="shell"><span style="color: #4f4;">‚ùØ</span> </span><span class="cmd">./target/release/examples/demo</span> <span class="flag">--concurrent</span>
‚úÖ <span style='color:#05f'><b>a</b></span> <b>Upload App</b>         [<span style='color:#0a0'>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>] 26.01KiB/26.01KiB (<span style='color:#f90'>0s</span> Ok!)
<span style='color:#0a0;width:25px;display:inline-block;'>‚†¶‚†¶</span><span style='color:#05f'><b>b</b></span> <b>Create DB</b>          [<span style='color:#0aa'>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë<span style='color:#05f'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 68B/100B (<span style='color:#f90'>0s</span> 1s)
‚úÖ <span style='color:#05f'><b>c</b></span> <b>Download App</b>       [<span style='color:#0a0'>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>] 26.01KiB/26.01KiB (<span style='color:#f90'>0s</span> Ok!)
‚è≥ <span style='color:#05f'><b>d</b></span> <b>Link App to DB</b>     [<span style='color:#05f'><span style='opacity:0.67'>                                        </span></span>] 0/100 (queued)
‚è≥ <span style='color:#05f'><b>e</b></span> <b>Run App</b>            [<span style='color:#05f'><span style='opacity:0.67'>                                        </span></span>] 0/100 (queued)
<span style='color:#0a0;width:25px;display:inline-block;'>‚†§‚†§</span><span style='color:#05f'><b>f</b></span> <b>Allocate Domain</b>    [<span style='color:#0aa'>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë<span style='color:#05f'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 67B/100B (<span style='color:#f90'>0s</span> 1s)
‚è≥ <span style='color:#05f'><b>g</b></span> <b>Attach Domain</b>      [<span style='color:#05f'><span style='opacity:0.67'>                                        </span></span>] 0/100 (queued)
‚è≥ <span style='color:#05f'><b>h</b></span> <b>Notify Completion</b>  [<span style='color:#05f'><span style='opacity:0.67'>                                        </span></span>] 0/100 (queued)
</pre>
</div>
<p>Example error:</p>
<div style="background-color: #111111; color: #ffffff; padding: 0px 5px 2px 5px; border-radius: 4px; width: 900px;">
<pre class="terminal">
<span class="shell"><span style="color: #4f4;">‚ùØ</span> </span><span class="cmd">./target/release/examples/demo</span> <span class="flag">--concurrent</span>
‚ùå <span style='color:#05f'><b>a</b></span> <b>Upload App</b>         [<span style='color:#555'><span style='color:#f00'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0B/772.42KiB (<span style='color:#f90'>0s</span>)
‚ò†Ô∏è <span style='color:#05f'><b>b</b></span> <b>Create DB</b>          [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
‚ò†Ô∏è <span style='color:#05f'><b>c</b></span> <b>Download App</b>       [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
‚ò†Ô∏è <span style='color:#05f'><b>d</b></span> <b>Link App to DB</b>     [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
‚ò†Ô∏è <span style='color:#05f'><b>e</b></span> <b>Run App</b>            [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
‚úÖ <span style='color:#05f'><b>f</b></span> <b>Allocate Domain</b>    [<span style='color:#0a0'><span style='opacity:0.67'>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span></span>] 100B/100B (<span style='color:#f90'>0s</span> Unchanged)
‚ò†Ô∏è <span style='color:#05f'><b>g</b></span> <b>Attach Domain</b>      [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
‚ò†Ô∏è <span style='color:#05f'><b>h</b></span> <b>Notify Completion</b>  [<span style='color:#f00'><span style='opacity:0.67'>‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</span></span>] 0/100 (parent failed)
<b><span style='color:#f55'>error[E06]</span>: Failed to connect to artifact server.</b>
  <span style='color:#05f'>‚îå‚îÄ</span> artifact_server_address:1:8
  <span style='color:#05f'>‚îÇ</span>
<span style='color:#05f'>1</span> <span style='color:#05f'>‚îÇ</span> http://<span style='color:#f00'>127.0.0.1:8000</span>
  <span style='color:#05f'>‚îÇ</span>        <span style='color:#f00'>^^^^^^^^^^^^^^</span> <span style='color:#f00'>failed to connect to server</span>
  <span style='color:#05f'>‚îÇ</span>
  <span style='color:#05f'>=</span> Try running `simple-http-server --nocache -u --ip 127.0.0.1 --port 8000`.
</pre>
</div>
</div>
</details>
<h2 id="api-implications-2"><a class="header" href="#api-implications-2">API Implications</a></h2>
<ul>
<li>
<p>Provide mechanism to specify end limit and progress.</p>
</li>
<li>
<p>Collect information, present it in a useful way:</p>
<ul>
<li>Real time interactive CLI presentation.</li>
<li>Useful errors.</li>
</ul>
</li>
</ul>
<p><code>choochoo</code> currently uses <a href="https://github.com/mitsuhiko/indicatif/"><code>indicatif</code></a> to display progress, and <a href="https://github.com/brendanzab/codespan"><code>codespan-reporting</code></a> to display errors.</p>
<p><code>indicatif</code> provides:</p>
<ul>
<li>Progress rendering</li>
<li>Elapsed time</li>
<li>Estimated time remaining</li>
<li>Styling</li>
</ul>
<h1 id="recoverability--repeatability"><a class="header" href="#recoverability--repeatability">Recoverability / Repeatability</a></h1>
<blockquote>
<p>Can execution resume from halfway.</p>
</blockquote>
<details open>
<summary>Workflow Steps</summary>
<p><img src="recoverability__repeatability_recoverability_0.generated.svg" alt="" title="Recoverability" /></p>
</details>
<h2 id="maturity-levels-3"><a class="header" href="#maturity-levels-3">Maturity Levels</a></h2>
<details>
<summary><b>üßπ Need manual clean up, <i>then</i> restart from scratch.</b></summary>
<div style="margin-left: 18px;">
<p>Usually takes effort to:</p>
<ul>
<li>Find out what needs cleaning up.</li>
<li>Figure out how to clean up, and do it.</li>
</ul>
<p>This will happen again.</p>
</div>
</details>
<details>
<summary><b>üîÅ Restart from scratch.</b></summary>
<div style="margin-left: 18px;">
<p>Tooling can automatically clean up for you.</p>
<p>Maybe you want to keep the failing environment around for investigation.</p>
</div>
</details>
<details>
<summary><b>‚ôªÔ∏è Reuse and recycle</b></summary>
<div style="margin-left: 18px;">
<p><img src="recoverability__repeatability_recoverability_1.generated.svg" alt="" title="Recoverability" /></p>
<ul>
<li>
<p>If it's already done, we won't do it again.</p>
</li>
<li>
<p>Replace / update existing resources.</p>
</li>
<li>
<p>Dependency updates must be propagated.</p>
<ul>
<li>Re-download file if it changed.</li>
<li>Restart the web application if configuration changed.</li>
</ul>
</li>
</ul>
<p>This means if we fail at 90% / 2 hours into the process, we can restart at that point without waiting another 2 hours.</p>
</div>
</details>
<h2 id="api-implications-3"><a class="header" href="#api-implications-3">API Implications</a></h2>
<ul>
<li>Implementors should provide a &quot;check&quot; function, and a &quot;do it&quot; function.</li>
<li>The check function checks if the task is in the desired state.</li>
<li>If not, the do it function is called.</li>
</ul>
<p><code>choochoo</code>:</p>
<ul>
<li>Requires a <code>visit_fn</code> (&quot;do it&quot; function).</li>
<li><code>check_fn</code> is run if present, otherwise it always runs the <code>visit_fn</code>.</li>
<li><strong>Bonus:</strong> The check function is run after the visit function to detect if the logic is correct.</li>
</ul>
<h2 id="live-demo-2"><a class="header" href="#live-demo-2">Live Demo</a></h2>
<ul>
<li>Run it twice.</li>
<li>Replay last 2 steps.</li>
<li>Update the file.</li>
</ul>
<pre><code class="language-bash">time ./target/release/examples/demo
</code></pre>
<pre><code class="language-bash">rm -rf /tmp/choochoo/demo/station_{g,h}
</code></pre>
<ul>
<li>
<p>514 KB, 1 second</p>
<pre><code class="language-bash">for i in {1..200000}; do printf &quot;application contents $i&quot;; done | gzip -f &gt; app.zip
</code></pre>
</li>
<li>
<p>5 MB, 7 seconds</p>
<pre><code class="language-bash">for i in {1..2000000}; do printf &quot;application contents $i&quot;; done | gzip -f &gt; app.zip
</code></pre>
</li>
</ul>
<h1 id="performance--efficiency"><a class="header" href="#performance--efficiency">Performance / Efficiency</a></h1>
<blockquote>
<p>How well is execution scheduled, time spent, and resources used.</p>
</blockquote>
<p><img src="performance__efficiency_performance__efficiency_0.generated.svg" alt="" title="Performance / Efficiency" /></p>
<h2 id="maturity-levels-4"><a class="header" href="#maturity-levels-4">Maturity Levels</a></h2>
<details>
<summary><b>Sequential:</b> One thing at a time.</summary>
<div style="margin-left: 18px;">
<ul>
<li>Very simple for troubleshooting.</li>
<li>Usually already good enough.</li>
</ul>
<p>No (extra) threads, no threading problems.</p>
</div>
</details>
<details>
<summary><b>Coarse parallelism:</b> Make a thread per task.</summary>
<div style="margin-left: 18px;">
<p><em>&quot;More threads means more speed right?&quot;</em></p>
<p>Only if you design for it.</p>
<p>This is like having one person allocated to each task. If your task breakdown is not good, then a person will be idling.</p>
</div>
</details>
<details>
<summary><b>Granular concurrency:</b> Task hopping.</summary>
<div style="margin-left: 18px;">
<p>When a threads needs to wait for something to be done for a given task, it can switch to another task ‚Äì assuming the task switched to can be worked on by different threads.</p>
</div>
</details>
<h2 id="api-implications-4"><a class="header" href="#api-implications-4">API Implications</a></h2>
<ul>
<li>Use <code>async</code> to operate concurrently.</li>
<li>Use multiple threads for parallelism.</li>
<li>Shared data must be behind appropriate <code>RwLock</code>s.</li>
<li>Can hurt API ergonomics.</li>
<li>Potential for deadlock if not designed well.</li>
</ul>
<p><code>choochoo</code>:</p>
<ul>
<li>Uses <code>Pin&lt;Box&lt;dyn Future .. &gt;&gt;</code> for the function return types ‚Äì tasks cannot be worked on by different threads.</li>
<li>Uses <code>tokio</code> as the async executor.</li>
</ul>
<h2 id="live-demo-3"><a class="header" href="#live-demo-3">Live Demo</a></h2>
<pre><code class="language-bash">rm -rf /tmp/choochoo/demo/station_{b,c,d,e,f,g,h} /tmp/server/app.zip
</code></pre>
<pre><code class="language-bash">time ./target/release/examples/demo
</code></pre>
<pre><code class="language-bash">time ./target/release/examples/demo --concurrent
</code></pre>
<h1 id="psychology"><a class="header" href="#psychology">Psychology</a></h1>
<blockquote>
<p>Did the user request what they intended?</p>
</blockquote>
<p>Does the software understand the <em>intent</em> of the user?</p>
<p>a.k.a. Can the developer predict intent ahead of time?</p>
<h2 id="maturity-levels-5"><a class="header" href="#maturity-levels-5">Maturity Levels</a></h2>
<pre><code class="language-bash"># User: &quot;create 100 servers&quot;
choochoo deploy --server-count 100
</code></pre>
<details>
<summary><b>Do as they say. Every time.</b></summary>
<div style="margin-left: 18px;">
<p>Want 100 servers? Sure.</p>
</div>
</details>
<details>
<summary><b>Guess desired state.</b></summary>
<div style="margin-left: 18px;">
<p>There's already 10 servers, so I'll just add 90 more.</p>
</div>
</details>
<details>
<summary><b>Protect from extreme values.</b></summary>
<div style="margin-left: 18px;">
<div style="background-color: #111111; color: #ffffff; padding: 0px 5px 2px 5px; border-radius: 4px;;">
<pre class="terminal">
<span class="shell"><span style="color: #4f4;">‚ùØ</span> </span><span class="cmd">choochoo deploy</span> <span class="flag">--server-count 100</span>
<b><span style='color:#ff0'>warning[W02]</span>: High server count.</b>
  <span style='color:#05f'>‚îå‚îÄ</span> command:1:16
  <span style='color:#05f'>‚îÇ</span>
<span style='color:#05f'>1</span> <span style='color:#05f'>‚îÇ</span> choochoo deploy <span style='color:#ff0'>--server-count 100</span>
  <span style='color:#05f'>‚îÇ</span>                 <span style='color:#ff0'>^^^^^^^^^^^^^^^^^^</span> <span style='color:#ff0'>specified here</span>
  <span style='color:#05f'>‚îÇ</span>
  <span style='color:#05f'>=</span> This can incur high costs.
  <span style='color:#05f'>=</span> Specify the `--allow-high-server-count` flag to bypass this check.<br />
  üöÇ Please type `<span style='color:#ff0;'>pancakes</span>` to proceed:
  <span class="shell"><span style="color: #ff0;">‚ùØ</span> pancakes_</span>
</pre>
</div>
</div>
</details>
<h2 id="api-implications-5"><a class="header" href="#api-implications-5">API Implications</a></h2>
<ul>
<li>Provide types with value limit checking.</li>
<li>Detect long elapsed time, and support graceful interrupt handling.</li>
<li>Design for dry run ‚Äì show what the software <em>would</em> do.</li>
</ul>
<p><code>choochoo</code> doesn't do this yet.</p>
<h1 id="future"><a class="header" href="#future">Future</a></h1>
<h2 id="to-do"><a class="header" href="#to-do">To Do</a></h2>
<ul>
<li>Dry run.</li>
<li>Make API ergonomic.</li>
<li>More granular execution.</li>
<li>Refine shared data access.</li>
<li>Handle signals (like <code>SIGINT</code>).</li>
</ul>
<h2 id="more-ideas"><a class="header" href="#more-ideas">More Ideas</a></h2>
<ul>
<li>Use <code>choochoo</code> not just for the deployment tool, but the agent running on the web server.</li>
<li>Split core functionality, have web frontend.</li>
<li>Serialize state to disk ‚Äì save / load execution.</li>
</ul>
<h1 id="questions-feedback-comments"><a class="header" href="#questions-feedback-comments">Questions, Feedback, Comments</a></h1>
<div
    id="smoke"
    style="
        font-size: 5em;
        font-weight: bold;
        margin-left: 75px;
        margin-bottom: -40px;
        font-family: monospace;
    ">choo choo</div>
<div style="font-size: 15em;">üöÇüí®</div>
<style type="text/css">
#smoke {
    animation-duration: 1.5s;
    animation-name: choo_choo;
}

@keyframes choo_choo {
  from {
    letter-spacing: -0.3em;
  }

  to {
    letter-spacing: 0.0em;
  }
}
</style><h1 id="links"><a class="header" href="#links">Links</a></h1>
<ul>
<li><a href="https://github.com/azriel91/choochoo/"><code>choochoo</code></a> repository</li>
<li><a href="https://github.com/azriel91/ops_ux/"><code>ops_ux</code></a> repository (this book)</li>
</ul>
<h1 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h1>
<ul>
<li>Execution fails halfway -- &quot;like rolling the dice.&quot;
<ul>
<li>Flakey connections / services.</li>
<li>Misspecified configuration / parameters.</li>
</ul>
</li>
<li>User does incorrect action / hard to troubleshoot.
<ul>
<li>Too much information presented to user.</li>
<li>Not enough information presented to user.</li>
<li>No access to information.</li>
<li>Not knowing of access to information.</li>
<li>User may not understand information.</li>
</ul>
</li>
<li>Hacked automation.
<ul>
<li>Tools calling tools.</li>
<li>No proper API to invoke / receive information.</li>
</ul>
</li>
<li>Parallel / concurrent execution interferes with each other.
<ul>
<li>Inadequate namespacing.</li>
</ul>
</li>
<li>Cost / unused resources.
<ul>
<li>Forgot to clean up.</li>
<li>No means to clean up.</li>
<li>Unaware that resource is allocated but not freed.</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
